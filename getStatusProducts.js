
const names = [
    "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∫–∞–±–µ–ª—å 45–º –¥–ª—è —Å–ø—É—Ç–Ω–∏–∫–∞ V2(Gen2)",
    "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 2 –º–µ—Ç—Ä–∞, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π",
    "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∫–∞–±–µ–ª—å 23–º –¥–ª—è —Å–ø—É—Ç–Ω–∏–∫–∞ V2(Gen2)",
    "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 20 –º–µ—Ç—Ä–æ–≤, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π, V5 Mini",
    "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 5 –º–µ—Ç—Ä–æ–≤, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π",
    "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 10 –º–µ—Ç—Ä–æ–≤, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π"
];

const starlink_gen2_45 = {
    "items": [
        {
            "offer_id": genArticle('–∫–∞–±-45'),
            "name": "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∫–∞–±–µ–ª—å 45–º –¥–ª—è —Å–ø—É—Ç–Ω–∏–∫–∞ V2(Gen2)",
            "description_category_id": 17028634,
            "type_id": 115012246,
            "price": "12550",
            "old_price": "14000",
            "vat": "0",
            "currency_code": "RUB",
            "barcode": "OZN", // –ö–æ–º–∞–Ω–¥–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
            "weight": 120,
            "weight_unit": "g",
            "depth": 250,
            "height": 50,
            "width": 250,
            "dimension_unit": "mm",
            "images": [
                "https://cdn1.ozone.ru/s3/multimedia-1-h/8154529397.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-1-h/8154553877.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-1-5/8108263265.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-1-6/8108263266.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-1-b/8108263271.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-1-8/8108263268.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-1-e/8108263274.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-1-g/8108263276.jpg"
            ],
            "attributes": [
                { "id": 8229, "values": [{ "dictionary_value_id": 115012246, "value": "–ö–∞–±–µ–ª—å –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" }] },
                { "id": 85, "values": [{ "dictionary_value_id": 971841445, "value": "–ù–µ—Ç –±—Ä–µ–Ω–¥–∞" }] },
                { "id": 9048, "values": [{ "value": "–æ–¥–¥2" }] }, // –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
                { "id": 10096, "values": [{ "dictionary_value_id": 61600, "value": "—Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π" }] },
                { "id": 22390, "values": [{ "value": "gen" }] }, // –î–ª–∏–Ω–∞ –∫–∞–±–µ–ª—è
                { "id": 5948, "values": [{ "dictionary_value_id": 34783, "value": "–î–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" }] }, // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
                // { "id": 6157, "values": [{ "value": "2" }] }, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ä–∞–∑—ä–µ–º–æ–≤
                { "id": 21652, "values": [{ "dictionary_value_id": 971214931, "value": "–ú–µ–¥—å" }] }, // –ú–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞
                { "id": 6468, "values": [{ "value": "45" }] }, // –î–ª–∏–Ω–∞ –≤ –º
                // { "id": 22270, "values": [{ "dictionary_value_id": 971417785, "value": "–§–∞–±—Ä–∏—á–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ" }] }, // –í—ã–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞
                // { "id": 4382, "values": [{ "value": "2000" }] }, // –†–∞–∑–º–µ—Ä—ã, –º–º
                // { "id": 4383, "values": [{ "value": "100" }] }, // –í–µ—Å —Ç–æ–≤–∞—Ä–∞, –≥
                { "id": 8962, "values": [{ "value": "1" }] }, // –ï–¥–∏–Ω–∏—Ü –≤ –æ–¥–Ω–æ–º —Ç–æ–≤–∞—Ä–µ
                { "id": 4384, "values": [{ "value": "–ö–∞–±–µ–ª—å —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –∑–∞–ø–µ—á–∞—Ç–∞–Ω–Ω—ã–π" }] }, // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è
                { "id": 11650, "values": [{ "value": "1" }] }, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–æ–¥—Å–∫–∏—Ö —É–ø–∞–∫–æ–≤–æ–∫
                { "id": 6036, "values": [{ "value": "5" }] } // –°—Ä–æ–∫ —Å–ª—É–∂–±—ã
            ]
        }
    ]
};

const starlink_2m = {
    "items": [
        {
            "offer_id": "–∫–±-2–º-001-461",
            "name": "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 2 –º–µ—Ç—Ä–∞, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π",
            "description_category_id": 17028634,
            "type_id": 115012246,
            "price": "6500",
            "old_price": "7000",
            "vat": "0",
            "currency_code": "RUB",
            "barcode": "OZN", // –ö–æ–º–∞–Ω–¥–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —à—Ç—Ä–∏—Ö–∫–æ–¥–∞
            "weight": 120,
            "weight_unit": "g",
            "depth": 140,
            "height": 40,
            "width": 140,
            "dimension_unit": "mm",
            "images": [
                "https://cdn1.ozone.ru/s3/multimedia-tmp-9/item-pic-a468ceabb414a0aa14d65323a8b3b746.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-tmp-2/item-pic-aa85098ebc031590870fee930c57a2aa.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-tmp-f/item-pic-5b28f095b9c2a617060b947006319541.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-tmp-6/item-pic-92240ca91ed382e68c81cd5e42d62e4d.jpg",
                "https://cdn1.ozone.ru/s3/multimedia-tmp-b/item-pic-f389d4f678bdbe4742b6a19d3a6d8346.jpg"
            ],
            "attributes": [
                { "id": 8229, "values": [{ "dictionary_value_id": 115012246, "value": "–ö–∞–±–µ–ª—å –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" }] },
                { "id": 85, "values": [{ "dictionary_value_id": 971841445, "value": "–ù–µ—Ç –±—Ä–µ–Ω–¥–∞" }] },
                { "id": 9048, "values": [{ "value": "1" }] }, // –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
                { "id": 10096, "values": [{ "dictionary_value_id": 61600, "value": "—Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π" }] },
                { "id": 22390, "values": [{ "value": "2" }] }, // –î–ª–∏–Ω–∞ –∫–∞–±–µ–ª—è
                { "id": 5948, "values": [{ "dictionary_value_id": 34783, "value": "–î–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" }] }, // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
                { "id": 6157, "values": [{ "value": "2" }] }, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ä–∞–∑—ä–µ–º–æ–≤
                { "id": 21652, "values": [{ "dictionary_value_id": 971214931, "value": "–ú–µ–¥—å" }] }, // –ú–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞
                { "id": 6468, "values": [{ "value": "2" }] }, // –î–ª–∏–Ω–∞ –≤ –º
                { "id": 22270, "values": [{ "dictionary_value_id": 971417785, "value": "–§–∞–±—Ä–∏—á–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ" }] }, // –í—ã–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞
                { "id": 4382, "values": [{ "value": "2000" }] }, // –†–∞–∑–º–µ—Ä—ã, –º–º
                { "id": 4383, "values": [{ "value": "100" }] }, // –í–µ—Å —Ç–æ–≤–∞—Ä–∞, –≥
                { "id": 8962, "values": [{ "value": "1" }] }, // –ï–¥–∏–Ω–∏—Ü –≤ –æ–¥–Ω–æ–º —Ç–æ–≤–∞—Ä–µ
                { "id": 4384, "values": [{ "value": "–ö–∞–±–µ–ª—å —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –∑–∞–ø–µ—á–∞—Ç–∞–Ω–Ω—ã–π" }] }, // –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è
                { "id": 11650, "values": [{ "value": "1" }] }, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–æ–¥—Å–∫–∏—Ö —É–ø–∞–∫–æ–≤–æ–∫
                { "id": 6036, "values": [{ "value": "5" }] } // –°—Ä–æ–∫ —Å–ª—É–∂–±—ã
            ]
        }
    ]
};




const namesObj = {
    ["–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∫–∞–±–µ–ª—å 45–º –¥–ª—è —Å–ø—É—Ç–Ω–∏–∫–∞ V2(Gen2)"]: starlink_gen2_45,
    ["–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 2 –º–µ—Ç—Ä–∞, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π"]: starlink_2m,
    // "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∫–∞–±–µ–ª—å 23–º –¥–ª—è —Å–ø—É—Ç–Ω–∏–∫–∞ V2(Gen2)",
    // "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 20 –º–µ—Ç—Ä–æ–≤, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π, V5 Mini",
    // "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 5 –º–µ—Ç—Ä–æ–≤, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π",
    // "–ö–∞–±–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è V5 Mini, 10 –º–µ—Ç—Ä–æ–≤, —Ç–µ–º–Ω–æ-—Å–µ—Ä—ã–π"
};


async function fetchAndCheckAllProducts() {
    try {
        let allOfferIds = [];
        let lastId = "";
        let hasNext = true;

        while (hasNext) {
            const listRes = await axios.post(
                `${API_CONFIG.baseURL}/v3/product/list`,
                {
                    filter: { visibility: "ALL" },
                    last_id: lastId,
                    limit: 1000,
                },
                { headers: API_CONFIG.headers }
            );

            const result = listRes.data.result;
            const items = result.items || [];

            if (items.length > 0) {
                allOfferIds.push(...items.map((i) => i.offer_id));
                lastId = result.last_id;
            }
            if (items.length < 1000) hasNext = false;
        }

        console.log(`‚úÖ –í—Å–µ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–æ–≤: ${allOfferIds.length}`);

        let allDetails = [];
        for (let i = 0; i < allOfferIds.length; i += 1000) {
            const chunk = allOfferIds.slice(i, i + 1000);
            const infoRes = await axios.post(
                `${API_CONFIG.baseURL}/v3/product/info/list`,
                { offer_id: chunk },
                { headers: API_CONFIG.headers }
            );

            const details = infoRes.data.result?.items || infoRes.data.items || [];
            allDetails.push(...details);
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –Ω–æ–≤—ã–µ –≤–≤–µ—Ä—Ö—É
        allDetails.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

        console.log("\n" + "=".repeat(120));
        console.log(
            "‚Ññ   | –ê–†–¢–ò–ö–£–õ        | –ü–†–û–î–ê–ï–¢–°–Ø? | –°–û–ó–î–ê–ù             | –ú–û–î–ï–†–ê–¶–ò–Ø  | –ü–†–ò–ß–ò–ù–ê (–µ—Å–ª–∏ –Ω–µ –ø—Ä–æ–¥–∞–µ—Ç—Å—è)"
        );
        console.log("-".repeat(120));

        allDetails.forEach((p, i) => {
            // 1. –ò–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏–∑ –æ–±—ä–µ–∫—Ç–∞ statuses
            const statusName = p.statuses?.status_name || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";

            // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–µ—Ä–∞—Ü–∏—é
            const moderateStatus = p.statuses?.moderate_status || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
            const isApproved = moderateStatus === "approved";

            // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å—Ç–∞—Ç–∫–∏ (has_stock: true –≤ –≤–∞—à–µ–º JSON)
            const hasStock = p.stocks?.has_stock === true;

            // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
            const isVisible = p.visible === true;

            let saleStatus = "üî¥ –ù–ï–¢";
            let reason = "OK";

            // –£—Å–ª–æ–≤–∏–µ –ø—Ä–æ–¥–∞–∂–∏: —Å—Ç–∞—Ç—É—Å "–ü—Ä–æ–¥–∞–µ—Ç—Å—è" –ò –Ω–∞–ª–∏—á–∏–µ —Å–∫–ª–∞–¥–∞ –ò –º–æ–¥–µ—Ä–∞—Ü–∏—è –æ–¥–æ–±—Ä–µ–Ω–∞
            if (statusName === "–ü—Ä–æ–¥–∞–µ—Ç—Å—è" && hasStock && isApproved) {
                saleStatus = "‚úÖ –î–ê";
            } else {
                let reasons = [];
                if (statusName !== "–ü—Ä–æ–¥–∞–µ—Ç—Å—è") reasons.push(`–°—Ç–∞—Ç—É—Å: ${statusName}`);
                if (!hasStock) reasons.push("–ù–µ—Ç —Å–∫–ª–∞–¥–∞");
                if (!isApproved) reasons.push(`–ú–æ–¥–µ—Ä–∞—Ü–∏—è: ${moderateStatus}`);
                if (!isVisible) reasons.push("–°–∫—Ä—ã—Ç");
                reason = reasons.join(" | ");
            }

            const num = (i + 1).toString().padEnd(3);
            const offerId = (p.offer_id || "---").padEnd(14);
            const sale = saleStatus.padEnd(10);
            const date = new Date(p.created_at).toLocaleString("ru-RU").padEnd(18);
            const mod = moderateStatus.padEnd(10);

            console.log(
                `${num} | ${offerId} | ${sale} | ${date} | ${mod} | ${reason}`
            );
        });

        console.log("-".repeat(120));
        console.log(`üèÅ –ì–æ—Ç–æ–≤–æ. –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${allDetails.length}`);


        const isSale = (statusName) => statusName === "–ü—Ä–æ–¥–∞–µ—Ç—Å—è" && hasStock && isApproved

        allDetails.forEach(p => {
            if (names.includes(p.name) && !isSale(p?.statusName)) {

            }
        });

    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞:", error.response?.data || error.message);
    } finally {
        process.exit();
    }
}

fetchAndCheckAllProducts();
